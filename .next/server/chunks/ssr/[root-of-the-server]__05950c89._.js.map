{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/genkit.ts"],"sourcesContent":["/**\n * @fileoverview This file initializes and configures the Genkit AI library.\n * It sets up the necessary plugins, in this case, the Google AI plugin for generative models.\n * It exports a configured `ai` object that can be used throughout the application to define\n * and run AI flows, prompts, and tools.\n */\nimport {genkit} from 'genkit';\nimport {googleAI} from '@genkit-ai/googleai';\nimport {firebase} from \"firebase-admin/lib/firebase-namespace-api\";\nimport App = firebase.app.App;\n\nexport const ai = genkit({\n  plugins: [\n    googleAI({\n      // The Gemini API key is currently read from the `GEMINI_API_KEY`\n      // environment variable.\n    }),\n  ],\n  // Flows are now auto-registered, so we don't need to list them here.\n  // This breaks the circular dependency between this file and the flow files.\n  flows: [],\n});\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;AACD;AAAA;AACA;AAAA;;;AAIO,MAAM,KAAK,CAAA,GAAA,uIAAA,CAAA,SAAM,AAAD,EAAE;IACvB,SAAS;QACP,CAAA,GAAA,2KAAA,CAAA,WAAQ,AAAD,EAAE;QAGT;KACD;IACD,qEAAqE;IACrE,4EAA4E;IAC5E,OAAO,EAAE;AACX","debugId":null}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/delete-user-data-flow.ts"],"sourcesContent":["\n'use server';\n/**\n * @fileOverview A Genkit flow for completely deleting a user and all their associated data.\n *\n * - deleteUserData - Deletes a user's profile, posts, storage files, conversations, and auth record.\n * - DeleteUserDataInput - The input type for the deleteUserData function.\n * - DeleteUserDataOutput - The return type for the deleteUserData function.\n */\n\nimport { ai } from '@/ai/genkit';\nimport { z } from 'genkit';\nimport { getFirestore, collection, query, where, getDocs, doc } from 'firebase-admin/firestore';\nimport { getStorage, ref, deleteObject } from 'firebase-admin/storage';\nimport { initializeApp, getApps, App } from 'firebase-admin/app';\nimport { getAuth } from 'firebase-admin/auth';\n\n\nconst DeleteUserDataInputSchema = z.object({\n  userId: z.string().describe('The UID of the user to be deleted.'),\n});\nexport type DeleteUserDataInput = z.infer<typeof DeleteUserDataInputSchema>;\n\nconst DeleteUserDataOutputSchema = z.object({\n  success: z.boolean(),\n  error: z.string().optional(),\n});\nexport type DeleteUserDataOutput = z.infer<typeof DeleteUserDataOutputSchema>;\n\n\nexport async function deleteUserData(input: DeleteUserDataInput): Promise<DeleteUserDataOutput> {\n    return deleteUserDataFlow(input);\n}\n\n\nconst deleteUserDataFlow = ai.defineFlow(\n  {\n    name: 'deleteUserDataFlow',\n    inputSchema: DeleteUserDataInputSchema,\n    outputSchema: DeleteUserDataOutputSchema,\n  },\n  async ({ userId }) => {\n    \n    // Initialize Firebase Admin SDK if not already initialized\n    let adminApp: App;\n    if (!getApps().length) {\n        adminApp = initializeApp();\n    } else {\n        adminApp = getApps()[0];\n    }\n    \n    const db = getFirestore(adminApp);\n    const storage = getStorage(adminApp);\n    const auth = getAuth(adminApp);\n\n    if (!userId) {\n        return { success: false, error: 'Kullanıcı ID\\'si sağlanmadı.' };\n    }\n\n    try {\n        const batch = db.batch();\n\n        // 1. Delete user's posts and associated storage files\n        const postsQuery = query(collection(db, 'posts'), where('authorId', '==', userId));\n        const postsSnapshot = await getDocs(postsQuery);\n        for (const postDoc of postsSnapshot.docs) {\n            const postData = postDoc.data();\n            if (postData.type === 'photo' && postData.url) {\n                try {\n                    const storageRef = ref(storage, postData.url);\n                    await deleteObject(storageRef);\n                } catch (error: any) {\n                    // It's okay if the file doesn't exist.\n                    if (error.code !== 'storage/object-not-found') {\n                        console.warn(`Could not delete storage file ${postData.url}:`, error);\n                    }\n                }\n            }\n             // Delete subcollections like comments and likes (if they exist)\n            const commentsRef = collection(db, 'posts', postDoc.id, 'comments');\n            const likesRef = collection(db, 'posts', postDoc.id, 'likes');\n            const commentsSnapshot = await getDocs(commentsRef);\n            const likesSnapshot = await getDocs(likesRef);\n            commentsSnapshot.forEach(doc => batch.delete(doc.ref));\n            likesSnapshot.forEach(doc => batch.delete(doc.ref));\n\n            batch.delete(postDoc.ref);\n        }\n\n        // 2. Delete user's conversations\n        const conversationsQuery = query(collection(db, 'conversations'), where('users', 'array-contains', userId));\n        const conversationsSnapshot = await getDocs(conversationsQuery);\n        for (const convoDoc of conversationsSnapshot.docs) {\n            // Delete all messages in the conversation's subcollection\n            const messagesRef = collection(db, 'conversations', convoDoc.id, 'messages');\n            const messagesSnapshot = await getDocs(messagesRef);\n            messagesSnapshot.forEach(messageDoc => {\n                batch.delete(messageDoc.ref);\n            });\n            // Delete the conversation document itself\n            batch.delete(convoDoc.ref);\n        }\n        \n        // 3. Delete user's likes and remove them from other's posts\n        // This can be complex. A simpler approach is to handle this via cloud functions\n        // or accept that \"like\" documents might become orphaned. For this scope, we skip deep like cleanup.\n\n        // 4. Remove user from other users' follow lists\n        const followersQuery = query(collection(db, 'users'), where('following', 'array-contains', userId));\n        const followersSnapshot = await getDocs(followersQuery);\n        // This is not efficient at scale. A better data model would be needed for a real app.\n        // For now, we are skipping this. The user's own follow lists will be deleted with their document.\n\n        // 5. Delete the user document from Firestore\n        const userDocRef = doc(db, 'users', userId);\n        batch.delete(userDocRef);\n        \n        // Delete user's own subcollections\n        const followersRef = collection(db, 'users', userId, 'followers');\n        const followingRef = collection(db, 'users', userId, 'following');\n        const galleryPermsRef = collection(db, 'users', userId, 'galleryPermissions');\n        \n        const [followersSnap, followingSnap, galleryPermsSnap] = await Promise.all([\n            getDocs(followersRef),\n            getDocs(followingRef),\n            getDocs(galleryPermsRef)\n        ]);\n\n        followersSnap.forEach(doc => batch.delete(doc.ref));\n        followingSnap.forEach(doc => batch.delete(doc.ref));\n        galleryPermsSnap.forEach(doc => batch.delete(doc.ref));\n\n        // Commit all batched Firestore deletions\n        await batch.commit();\n\n        // 6. Delete the user from Firebase Authentication\n        await auth.deleteUser(userId);\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(`Failed to delete user ${userId}:`, error);\n        return { success: false, error: `Hesap silinirken bir hata oluştu: ${error.message}` };\n    }\n  }\n);\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 431, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/%28app%29/profile/edit/users/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {deleteUserData as '4076365984dec01c64a5fd543a3b6e6674f10ecaec'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 518, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/profile/edit/users/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/profile/edit/users/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/profile/edit/users/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA6S,GAC1U,2EACA","debugId":null}},
    {"offset": {"line": 532, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/profile/edit/users/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/profile/edit/users/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/profile/edit/users/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAyR,GACtT,uDACA","debugId":null}},
    {"offset": {"line": 546, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}